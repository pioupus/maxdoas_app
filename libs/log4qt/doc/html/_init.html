<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Log4Qt: Initialization procedure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Initialization procedure </h1>  </div>
</div>
<div class="contents">
<p>The package is initialised in two stages. The first stage takes place during static initialization. The second stage takes place when the <a class="el" href="class_log4_qt_1_1_log_manager.html">LogManager</a> singleton is created.</p>
<p>During static initialisation the <a class="el" href="class_log4_qt_1_1_initialisation_helper.html">InitialisationHelper</a> singleton is created . On construction it captures the program startup time, reads the required values from the system environment and registers the package types with the Qt type system.</p>
<p>The <a class="el" href="class_log4_qt_1_1_log_manager.html">LogManager</a> singleton is created on first use. The creation is usually triggered by the request for a <a class="el" href="class_log4_qt_1_1_logger.html">Logger</a> object. The call to <a class="el" href="class_log4_qt_1_1_logger.html#a8dff65cb4b334bdbd10dd39e93ddabca">Logger::logger()</a> is passed through to <a class="el" href="class_log4_qt_1_1_log_manager.html#a655c3f0a04fb6d7fb04644805a32d97d">LogManager::logger()</a>. On creation the <a class="el" href="class_log4_qt_1_1_log_manager.html">LogManager</a> creates a <a class="el" href="class_log4_qt_1_1_hierarchy.html">Hierarchy</a> object as logger repository.</p>
<p>After the singleton is created the logging of the package is configured to its default by a call to <a class="el" href="class_log4_qt_1_1_log_manager.html#a4a9e84efcf883b73f0271b7ea01ec605">LogManager::configureLogLogger()</a>. The logger <a class="el" href="class_log4_qt_1_1_log_manager.html#afd8e6d12cfab3ffd0c68cbab45c79609">logLogger()</a> is configured to be not additive. Messages with the level <a class="el" href="class_log4_qt_1_1_level.html#a5cd72b3cca61f4c5a50ffb383cd56d00a9e94e68775f87df73eb1833762d2c6e9">Level::ERROR_INT</a> and <a class="el" href="class_log4_qt_1_1_level.html#a5cd72b3cca61f4c5a50ffb383cd56d00a111e829ec821bde8535163b5d587ef88">Level::FATAL_INT</a> are written to <code>stderr</code> using a ConsoleAppender. The remaining messages are written to <code>stdout</code> using a second ConsoleAppender. The level is read from the system environment or application settings using <a class="el" href="class_log4_qt_1_1_initialisation_helper.html#a2665fe19bb2add308cbb26a0a20cbc8f">InitialisationHelper::setting()</a> with the key <code>Debug</code>. If a level value is found, but it is not a valid Level string, <a class="el" href="class_log4_qt_1_1_level.html#a5cd72b3cca61f4c5a50ffb383cd56d00a61a77a907d3d6e443639f7570f84fd56">Level::DEBUG_INT</a> is used. If no level string is found <a class="el" href="class_log4_qt_1_1_level.html#a5cd72b3cca61f4c5a50ffb383cd56d00a9e94e68775f87df73eb1833762d2c6e9">Level::ERROR_INT</a> is used.</p>
<p>Once the logging is configured the package is initialised by a call to <a class="el" href="class_log4_qt_1_1_log_manager.html#a1296ef5e63bea63aea91c09197c56f4d">LogManager::startup()</a>. The function will test for the setting <code>DefaultInitOverride</code> in the system environment and application settings using <a class="el" href="class_log4_qt_1_1_initialisation_helper.html#a2665fe19bb2add308cbb26a0a20cbc8f">InitialisationHelper::setting()</a>. If the value is present and set to anything else then <code>false</code>, the initialisation is aborted.<br/>
 The system environment and application settings are tested for the setting <code>Configuration</code>. If it is found and it is a valid path to a file, the package is configured with the file using <a class="el" href="class_log4_qt_1_1_property_configurator.html#a6280f3dba1e87ebe8918952e13489171">PropertyConfigurator::doConfigure()</a>. If the setting <code>Configuration</code> is not available and a QCoreApplication object is present, the application settings are tested for a group <code>Log4Qt/Properties</code>. If the group exists, the package is configured with the setting using the <a class="el" href="class_log4_qt_1_1_property_configurator.html#a8fcd67477ea9ce37ef3a67344b114875">PropertyConfiguratordoConfigure()</a>. If neither a configuration file nor configuration settings could be found, the current working directory is searched for the file <code>"log4qt.properties"</code>. If it is found, the package is configured with the file using <a class="el" href="class_log4_qt_1_1_property_configurator.html#a6280f3dba1e87ebe8918952e13489171">PropertyConfigurator::doConfigure()</a>.</p>
<p>The following example shows how to use application settings to initialise the package.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> # file: myapplication.h</span>
<span class="preprocessor"></span>
<span class="preprocessor"> #include qapplication.h</span>
<span class="preprocessor"></span>
 <span class="keyword">class </span>MyApplication : <span class="keyword">public</span> QApplication
 {
     Q_OBJECT

 <span class="keyword">public</span>:
     MyApplication();
     ~MyApplication();
     <span class="keywordtype">void</span> setupLog4Qt();
 }
</pre></div> <div class="fragment"><pre class="fragment"><span class="preprocessor"> # file: myapplication.cpp</span>
<span class="preprocessor"></span>
<span class="preprocessor"> #include myapplication.h</span>
<span class="preprocessor"></span>
 MyApplication::MyApplication(
 {
     <span class="comment">// Set Application data to allow Log4Qt initialisation to read the</span>
     <span class="comment">// correct values</span>
     setApplicationName(<span class="stringliteral">&quot;MyApplication&quot;</span>);
     setOrganisationName(<span class="stringliteral">&quot;MyOrganisation&quot;</span>);
     setOrganizationDomain(<span class="stringliteral">&quot;www.myorganisation.com&quot;</span>);

     <span class="comment">// Log first message, which initialises Log4Qt</span>
     <a class="code" href="class_log4_qt_1_1_logger.html#a8dff65cb4b334bdbd10dd39e93ddabca">Log4Qt::Logger::logger</a>(<span class="stringliteral">&quot;MyApplication&quot;</span>)-&gt;info(<span class="stringliteral">&quot;Hello World&quot;</span>);
 }

 MyApplication::~MyApplication()
 {
 }

 <span class="keywordtype">void</span> MyApplication::setupLog4Qt()
 {
     QSettings s;

     <span class="comment">// Set logging level for Log4Qt to TRACE</span>
     s.beginGroup(<span class="stringliteral">&quot;Log4Qt&quot;</span>);
     s.setValue(<span class="stringliteral">&quot;Debug&quot;</span>, <span class="stringliteral">&quot;TRACE&quot;</span>);

     <span class="comment">// Configure logging to log to the file C:/myapp.log using the level TRACE</span>
     s.beginGroup(<span class="stringliteral">&quot;Properties&quot;</span>);
     s.setValue(<span class="stringliteral">&quot;log4j.appender.A1&quot;</span>, <span class="stringliteral">&quot;org.apache.log4j.FileAppender&quot;</span>);
     s.setValue(<span class="stringliteral">&quot;log4j.appender.A1.file&quot;</span>, <span class="stringliteral">&quot;C:/myapp.log&quot;</span>);
     s.setValue(<span class="stringliteral">&quot;log4j.appender.A1.layout&quot;</span>, <span class="stringliteral">&quot;org.apache.log4j.TTCCLayout&quot;</span>);
     s.setValue(<span class="stringliteral">&quot;log4j.appender.A1.layout.DateFormat&quot;</span>, <span class="stringliteral">&quot;ISO8601&quot;</span>);
     s.setValue(<span class="stringliteral">&quot;log4j.rootLogger&quot;</span>, <span class="stringliteral">&quot;TRACE, A1&quot;</span>);

     <span class="comment">// Settings will become active on next application startup</span>
 }
</pre></div> </div>
<hr class="footer"/><address class="footer"><small>Generated on Fri May 27 2011 17:14:39 for Log4Qt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
